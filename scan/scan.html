<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scan QR</title>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{background:#0e0c0a;color:#d4af6a;font-family:Arial;text-align:center}
#reader{width:300px;margin:30px auto}
</style>
</head>

<body>

<h2>SCAN QR TAMU</h2>
<div id="reader"></div>
<p id="status">Siap scan…</p>

<script>
const SHEET_URL="https://script.google.com/macros/s/AKfycbyI3EEgA9H601DWrKh8q9UygS3x0G6wb4ZTQr1BUjPQtKOs1U96egU7nhIkObxlMzcYMA/exec";
let lock=false;

function onScanSuccess(txt){
  if(lock)return;
  lock=true;
  const token=txt.split("|")[1];

  const p=new URLSearchParams();
  p.append("mode","checkin");
  p.append("token",token);

  fetch(SHEET_URL,{method:"POST",body:p})
    .then(r=>r.text())
    .then(r=>{
      if(r==="success") status.innerText="✅ Check-in berhasil";
      else if(r==="duplicate") status.innerText="⚠️ Sudah digunakan";
      else status.innerText="❌ Tidak ditemukan";
    })
    .finally(()=>setTimeout(()=>lock=false,1500));
}

new Html5Qrcode("reader").start(
  {facingMode:"environment"},
  {fps:10,qrbox:250},
  onScanSuccess
);
</script>

</body>
</html>

