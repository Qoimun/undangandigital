<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>The Wedding of Fulan & Fulanah (3D Edition)</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- QRCode Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<!-- THREE.JS Library (Untuk 3D) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<style>
:root {
  --bg-dark: #050505;
  --gold: #d4af6a;
  --gold-light: #f3e5ab;
  --text-main: #f0f0f0;
  --glass-bg: rgba(20, 20, 20, 0.6);
  --glass-border: rgba(212, 175, 106, 0.2);
  --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
  --transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
}

* { margin: 0; padding: 0; box-sizing: border-box; outline: none; }

html { scroll-behavior: smooth; }

body {
  font-family: 'Poppins', sans-serif;
  background-color: var(--bg-dark);
  color: var(--text-main);
  overflow-x: hidden;
  line-height: 1.6;
}

/* Typography */
h1, h2, h3 { font-family: 'Playfair Display', serif; color: var(--gold); text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
.font-script { font-family: 'Great Vibes', cursive; font-weight: 400; color: var(--gold-light); }

/* Utility Classes */
.container { max-width: 1000px; margin: 0 auto; padding: 0 20px; position: relative; z-index: 2; }
.section-padding { padding: 100px 0; }
.text-center { text-align: center; }
.hidden { display: none !important; }

/* 3D Effects Classes */
.glass-panel {
  background: var(--glass-bg);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1px solid var(--glass-border);
  box-shadow: var(--shadow);
  border-radius: 20px;
  transition: var(--transition);
}

/* Animations */
@keyframes fadeInUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
@keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }

.animate-on-scroll { opacity: 0; transform: translateY(30px); transition: var(--transition); }
.animate-on-scroll.visible { opacity: 1; transform: translateY(0); }

/* --- 3D BACKGROUND CANVAS --- */
#webgl-canvas {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: -1;
  outline: none;
}

/* --- COVER OVERLAY --- */
#cover-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: url('https://picsum.photos/seed/weddingbg/1920/1080') no-repeat center center/cover;
  z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center;
  transition: transform 1s cubic-bezier(0.77, 0, 0.175, 1);
}
#cover-overlay::before { content: ''; position: absolute; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
#cover-overlay.opened { transform: scale(1.5) opacity(0); pointer-events: none; }

.cover-content { position: relative; z-index: 2; text-align: center; padding: 20px; transform-style: preserve-3d; }
.cover-title { font-size: 2.5rem; letter-spacing: 4px; margin-bottom: 10px; color: #fff; font-weight: 700; }
.cover-couple { font-size: 4.5rem; color: var(--gold); margin: 20px 0; text-shadow: 0 0 20px rgba(212, 175, 106, 0.6); font-family: 'Great Vibes', cursive; }

.btn-open {
  background: linear-gradient(45deg, var(--gold), #b8962d);
  color: #000; font-family: 'Playfair Display', serif; font-weight: 700;
  padding: 18px 50px; border: none; border-radius: 50px; font-size: 1.2rem; cursor: pointer;
  box-shadow: 0 0 30px rgba(212, 175, 106, 0.6); transition: var(--transition); display: inline-flex; align-items: center; gap: 10px;
  text-transform: uppercase; letter-spacing: 2px;
}
.btn-open:hover { transform: scale(1.1) translateY(-5px); box-shadow: 0 0 50px rgba(212, 175, 106, 0.9); }

/* --- HERO SECTION --- */
#hero { height: 90vh; display: flex; align-items: center; justify-content: center; text-align: center; position: relative; }
.bismillah { font-size: 1.8rem; margin-bottom: 20px; display: block; color: #fff; opacity: 0.8; }
.hero-names { font-size: 4.5rem; line-height: 1.2; margin: 20px 0; text-shadow: 0 4px 20px rgba(0,0,0,0.8); }
.hero-date { font-size: 1.4rem; letter-spacing: 4px; color: var(--gold); border-top: 1px solid var(--gold); border-bottom: 1px solid var(--gold); display: inline-block; padding: 15px 40px; margin-top: 20px; background: rgba(0,0,0,0.4); border-radius: 50px; }

/* --- COUPLE SECTION (3D Cards) --- */
.couple-card { 
  padding: 40px 20px; margin: 30px 0; position: relative; overflow: hidden; 
  transform-style: preserve-3d; perspective: 1000px;
}
.photo-frame { 
  width: 180px; height: 180px; border-radius: 50%; padding: 8px; 
  border: 3px solid var(--gold); margin: 0 auto 25px; overflow: hidden;
  box-shadow: 0 0 30px rgba(212, 175, 106, 0.3); transition: var(--transition);
}
.photo-frame img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
.couple-name { font-size: 2.5rem; margin-bottom: 10px; }
.couple-parents { font-size: 1rem; color: #ccc; }
.separator { font-size: 4rem; color: var(--gold); margin: 30px 0; text-shadow: 0 0 20px var(--gold); }

/* --- EVENT SECTION --- */
.timeline { position: relative; max-width: 800px; margin: 0 auto; padding: 20px 0; }
.timeline::after { content: ''; position: absolute; width: 3px; background: linear-gradient(to bottom, transparent, var(--gold), transparent); top: 0; bottom: 0; left: 50%; margin-left: -1.5px; box-shadow: 0 0 10px var(--gold); }
.event-item { padding: 20px 40px; position: relative; width: 50%; box-sizing: border-box; }
.event-item.left { left: 0; text-align: right; }
.event-item.right { left: 50%; text-align: left; }
.event-content { padding: 30px; border-radius: 20px; position: relative; z-index: 2; transition: var(--transition); transform: translateZ(20px); }
.event-content:hover { transform: translateZ(50px) scale(1.02); box-shadow: 0 15px 40px rgba(0,0,0,0.5); border-color: var(--gold); }
.event-icon { 
  position: absolute; width: 50px; height: 50px; background: var(--bg-dark); color: var(--gold); 
  border-radius: 50%; top: 25px; display: flex; align-items: center; justify-content: center; 
  font-weight: bold; z-index: 3; border: 2px solid var(--gold); box-shadow: 0 0 15px var(--gold);
}
.left .event-icon { right: -25px; }
.right .event-icon { left: -25px; }

/* --- COUNTDOWN --- */
#countdown { display: flex; justify-content: center; gap: 25px; margin-top: 50px; flex-wrap: wrap; }
.time-box { 
  background: rgba(0,0,0,0.6); border: 1px solid var(--gold); padding: 25px; 
  border-radius: 15px; min-width: 100px; text-align: center; 
  box-shadow: 0 0 20px rgba(212, 175, 106, 0.2); transform-style: preserve-3d;
}
.time-val { font-size: 3rem; font-weight: 700; color: var(--gold); font-family: 'Playfair Display', serif; display: block; }
.time-label { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 2px; color: #aaa; }

/* --- GALLERY (3D Tilt) --- */
.gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 50px; perspective: 1000px; }
.gallery-item { 
  position: relative; overflow: hidden; border-radius: 15px; aspect-ratio: 3/4; cursor: pointer; 
  border: 1px solid rgba(255,255,255,0.1); transform-style: preserve-3d;
  transition: transform 0.5s ease;
}
.gallery-item:hover { transform: rotateY(10deg) rotateX(10deg) scale(1.05); z-index: 10; box-shadow: 0 20px 40px rgba(0,0,0,0.6); }
.gallery-item img { width: 100%; height: 100%; object-fit: cover; }

/* --- RSVP SECTION --- */
.rsvp-card { padding: 50px; max-width: 700px; margin: 0 auto; position: relative; overflow: hidden; }
.rsvp-card::before {
  content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
  background: radial-gradient(circle, rgba(212,175,106,0.1) 0%, transparent 70%);
  animation: rotateBg 10s linear infinite; pointer-events: none;
}
@keyframes rotateBg { 0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);} }

.input-group { margin-bottom: 25px; text-align: left; position: relative; z-index: 1; }
.input-group label { display: block; margin-bottom: 10px; font-size: 0.95rem; color: var(--gold); letter-spacing: 1px; font-weight: 500; }
.form-control { 
  width: 100%; padding: 18px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); 
  border-radius: 10px; color: #fff; font-family: 'Poppins', sans-serif; transition: var(--transition); 
}
.form-control:focus { border-color: var(--gold); background: rgba(255,255,255,0.1); box-shadow: 0 0 15px rgba(212,175,106,0.3); }
.btn-submit { 
  width: 100%; padding: 18px; background: var(--gold); color: #000; font-weight: 700; 
  border: none; border-radius: 10px; cursor: pointer; transition: var(--transition); font-size: 1.1rem; 
  text-transform: uppercase; letter-spacing: 1px; position: relative; z-index: 1;
}
.btn-submit:disabled { background: #555; cursor: not-allowed; }
.btn-submit:hover { background: #fff; transform: translateY(-3px); box-shadow: 0 10px 20px rgba(212, 175, 106, 0.5); }

.rsvp-success { text-align: center; animation: fadeInUp 0.5s ease; }
.ticket-qr { background: #fff; padding: 20px; display: inline-block; border-radius: 15px; margin-top: 20px; box-shadow: 0 0 20px var(--gold); }

/* --- FOOTER --- */
footer { padding: 50px 20px; text-align: center; font-size: 0.9rem; color: var(--text-muted); position: relative; z-index: 2; }

/* --- MUSIC CONTROL --- */
.music-control { 
  position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; background: var(--gold); color: #000; 
  border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 100; 
  box-shadow: 0 0 20px rgba(212, 175, 106, 0.6); animation: float 3s ease-in-out infinite; border: 2px solid #fff;
}

/* --- RESPONSIVE --- */
@media (max-width: 768px) {
  .timeline::after { left: 31px; }
  .event-item { width: 100%; padding-left: 80px; padding-right: 25px; }
  .event-item.left, .event-item.right { left: 0; text-align: left; }
  .event-item.left .event-icon, .event-item.right .event-icon { left: 6px; right: auto; }
  .hero-names { font-size: 3rem; }
  .cover-couple { font-size: 3.5rem; }
  .rsvp-card { padding: 30px 20px; }
}
</style>
</head>

<body>

<!-- 3D Background Canvas -->
<canvas id="webgl-canvas"></canvas>

<!-- Music Control -->
<div class="music-control" id="music-btn" onclick="toggleMusic()">
  <i class="fas fa-music"></i>
</div>

<!-- COVER OVERLAY -->
<div id="cover-overlay">
  <div class="cover-content">
    <h3 class="cover-title">The Wedding Of</h3>
    <h1 class="cover-couple">Fulan & Fulanah</h1>
    <p style="color: #fff; letter-spacing: 2px; margin-bottom: 40px; font-size: 1.2rem;">23 MEI 2026</p>
    <button class="btn-open" onclick="openInvitation()">
      <i class="fas fa-paper-plane"></i> Buka Undangan
    </button>
  </div>
</div>

<!-- MAIN CONTENT -->
<main>
  <!-- HERO -->
  <section id="hero">
    <div class="container animate-on-scroll">
      <span class="font-script bismillah" style="font-size: 2rem;">Assalamualaikum Warahmatullahi Wabarakatuh</span>
      <h1 class="hero-names">Fulan <span style="font-size:0.5em; vertical-align:middle; color:var(--gold)">&</span> Fulanah</h1>
      <div class="hero-date">SABTU, 23 MEI 2026</div>
    </div>
  </section>

  <!-- COUPLE -->
  <section class="section-padding" id="couple">
    <div class="container">
      <h2 class="text-center font-script" style="font-size: 4rem; margin-bottom: 60px;">Mempelai</h2>
      
      <div class="couple-card glass-panel animate-on-scroll">
        <div class="photo-frame">
          <img src="https://picsum.photos/seed/groom/400/400" alt="Fulan">
        </div>
        <h3 class="couple-name font-script">Fulan bin Fulan</h3>
        <p class="couple-parents">Putra dari Bpk. Fulan & Ibu Fulanah</p>
      </div>

      <div class="separator text-center">&</div>

      <div class="couple-card glass-panel animate-on-scroll">
        <div class="photo-frame">
          <img src="https://picsum.photos/seed/bride/400/400" alt="Fulanah">
        </div>
        <h3 class="couple-name font-script">Fulanah binti Fulan</h3>
        <p class="couple-parents">Putri dari Bpk. Fulan & Ibu Fulanah</p>
      </div>
    </div>
  </section>

  <!-- EVENT -->
  <section class="section-padding">
    <div class="container">
      <h2 class="text-center" style="margin-bottom: 60px; text-shadow: 0 0 10px var(--gold);">Rangkaian Acara</h2>
      
      <div class="timeline">
        <div class="event-item left animate-on-scroll">
          <div class="event-icon"><i class="fas fa-handshake"></i></div>
          <div class="event-content glass-panel">
            <h3>Akad Nikah</h3>
            <p style="color:var(--gold); font-weight:600;">08:00 WIB - 10:00 WIB</p>
            <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:15px 0;">
            <p>Masjid Agung, Gawok<br>Sukoharjo</p>
          </div>
        </div>

        <div class="event-item right animate-on-scroll">
          <div class="event-icon"><i class="fas fa-glass-cheers"></i></div>
          <div class="event-content glass-panel">
            <h3>Resepsi</h3>
            <p style="color:var(--gold); font-weight:600;">11:00 WIB - Selesai</p>
            <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:15px 0;">
            <p>Ballroom Hotel, Gawok<br>Sukoharjo</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- COUNTDOWN -->
  <section class="section-padding text-center">
    <div class="container animate-on-scroll">
      <h2>Menuju Hari Bahagia</h2>
      <div id="countdown">
        <div class="time-box"><span class="time-val" id="cd-days">0</span><span class="time-label">Hari</span></div>
        <div class="time-box"><span class="time-val" id="cd-hours">0</span><span class="time-label">Jam</span></div>
        <div class="time-box"><span class="time-val" id="cd-mins">0</span><span class="time-label">Menit</span></div>
        <div class="time-box"><span class="time-val" id="cd-secs">0</span><span class="time-label">Detik</span></div>
      </div>
    </div>
  </section>

  <!-- GALLERY -->
  <section class="section-padding" id="gallery">
    <div class="container">
      <h2 class="text-center font-script" style="font-size: 3rem; margin-bottom: 40px; text-shadow: 0 0 10px var(--gold);">Galeri Momen</h2>
      <div class="gallery-grid">
        <div class="gallery-item glass-panel animate-on-scroll"><img src="https://picsum.photos/seed/wed1/600/800" alt="Gallery 1"></div>
        <div class="gallery-item glass-panel animate-on-scroll"><img src="https://picsum.photos/seed/wed2/600/800" alt="Gallery 2"></div>
        <div class="gallery-item glass-panel animate-on-scroll"><img src="https://picsum.photos/seed/wed3/600/800" alt="Gallery 3"></div>
        <div class="gallery-item glass-panel animate-on-scroll"><img src="https://picsum.photos/seed/wed4/600/800" alt="Gallery 4"></div>
      </div>
    </div>
  </section>

  <!-- RSVP -->
  <section class="section-padding" id="rsvp">
    <div class="container">
      <h2 class="text-center" style="margin-bottom: 50px;">RSVP & Ucapan</h2>
      
      <div class="rsvp-card glass-panel animate-on-scroll">
        <!-- Form -->
        <div id="rsvp-form-container">
          <div class="input-group">
            <label for="nama">Nama Lengkap</label>
            <input type="text" id="nama" class="form-control" placeholder="Tulis nama Anda" required>
          </div>

          <div class="input-group">
            <label for="hadir">Konfirmasi Kehadiran</label>
            <select id="hadir" class="form-control">
              <option value="Hadir">Hadir</option>
              <option value="Tidak Hadir">Tidak Hadir</option>
              <option value="Masih Ragu">Masih Ragu</option>
            </select>
          </div>

          <!-- KOLOM ALAMAT BARU -->
          <div class="input-group">
            <label for="alamat">Alamat Domisili / Asal</label>
            <input type="text" id="alamat" class="form-control" placeholder="Contoh: Jakarta Selatan" required>
          </div>

          <div class="input-group">
            <label for="pesan">Ucapan & Doa</label>
            <textarea id="pesan" class="form-control" rows="4" placeholder="Tulis ucapan untuk mempelai" required></textarea>
          </div>

          <button id="btn-submit" class="btn-submit" onclick="kirim()">
            <i class="fas fa-paper-plane"></i> Kirim Konfirmasi
          </button>
        </div>

        <!-- Success View (Hidden) -->
        <div id="rsvp-success" class="rsvp-success hidden">
          <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--gold); margin-bottom: 20px; filter: drop-shadow(0 0 10px var(--gold));"></i>
          <h3>Terima Kasih!</h3>
          <p>Konfirmasi kehadiran Anda telah kami terima.</p>
          <p style="font-size: 0.9rem; color: #ccc; margin-top: 15px;">Simpan QR Code ini sebagai bukti tiket masuk.</p>
          <div id="qr" class="ticket-qr"></div>
          <button class="btn-submit" onclick="resetForm()" style="margin-top:25px; background: transparent; border: 1px solid var(--gold); color: var(--gold);">Kirim Ulang</button>
        </div>

      </div>
    </div>
  </section>
</main>

<footer>
  <p class="font-script" style="font-size: 2rem; margin-bottom: 10px;">Fulan & Fulanah</p>
  <p>&copy; 2026 Wedding Invitation. Made with Love & 3D Magic.</p>
</footer>

<script>
/* =========================================
   KONFIGURASI URL SCRIPT (SAMA SEPERTI SEBELUMNYA)
   ========================================= */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz9kROyde8G2F-JKsW4M80K9kKo_ov0uASdkHQlHqpBlxPqKYiugzsuJPbqhXip30MJpQ/exec"; 
const TARGET_DATE = new Date("2026-05-23T08:00:00").getTime();

/* =========================================
   THREE.JS: 3D PARTICLE TUNNEL ANIMATION
   ========================================= */
const init3D = () => {
  const canvas = document.getElementById('webgl-canvas');
  const scene = new THREE.Scene();
  
  // Fog untuk kedalaman (Warna disesuaikan bg)
  scene.fog = new THREE.FogExp2(0x050505, 0.002);

  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.z = 100;

  const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio);

  // 1. PARTICLE TUNNEL
  const particlesGeometry = new THREE.BufferGeometry();
  const particlesCount = 2000;
  const posArray = new Float32Array(particlesCount * 3);

  for(let i = 0; i < particlesCount * 3; i++) {
    // Sebar partikel secara acak di ruang 3D
    posArray[i] = (Math.random() - 0.5) * 200; 
  }

  particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));

  const material = new THREE.PointsMaterial({
    size: 0.5,
    color: 0xd4af6a, // Warna Emas
    transparent: true,
    opacity: 0.8,
    blending: THREE.AdditiveBlending
  });

  const particlesMesh = new THREE.Points(particlesGeometry, material);
  scene.add(particlesMesh);

  // 2. FLOATING GEOMETRY (Rings / Icosahedron)
  const ringGeo = new THREE.TorusGeometry(30, 0.2, 16, 100);
  const ringMat = new THREE.MeshBasicMaterial({ color: 0xd4af6a, transparent: true, opacity: 0.2, wireframe: true });
  const ring1 = new THREE.Mesh(ringGeo, ringMat);
  const ring2 = new THREE.Mesh(ringGeo, ringMat);
  
  ring1.position.set(-40, 0, -50);
  ring2.position.set(40, 0, -100);
  
  scene.add(ring1);
  scene.add(ring2);

  // Mouse Interaction Variables
  let mouseX = 0;
  let mouseY = 0;
  let targetX = 0;
  let targetY = 0;

  const windowHalfX = window.innerWidth / 2;
  const windowHalfY = window.innerHeight / 2;

  document.addEventListener('mousemove', (event) => {
    mouseX = (event.clientX - windowHalfX);
    mouseY = (event.clientY - windowHalfY);
  });

  // Animation Variables
  let speed = 0.2; // Kecepatan normal
  let warpSpeed = false; // Status Warp

  // Expose function to be called by HTML button
  window.triggerWarp = () => {
    warpSpeed = true;
    setTimeout(() => { warpSpeed = false; }, 1500); // Warp selama 1.5 detik
  };

  const animate = () => {
    requestAnimationFrame(animate);

    targetX = mouseX * 0.001;
    targetY = mouseY * 0.001;

    // Rotasi partikel berdasarkan mouse (Parallax)
    particlesMesh.rotation.y += 0.05 * (targetX - particlesMesh.rotation.y);
    particlesMesh.rotation.x += 0.05 * (targetY - particlesMesh.rotation.x);
    
    // Rotasi Rings
    ring1.rotation.x += 0.005;
    ring1.rotation.y += 0.005;
    ring2.rotation.x -= 0.003;
    ring2.rotation.y -= 0.005;

    // Gerakan Partikel (Terowongan)
    const positions = particlesGeometry.attributes.position.array;
    
    // Logika Kecepatan (Normal vs Warp)
    const currentSpeed = warpSpeed ? 5 : 0.2;

    for(let i = 2; i < particlesCount * 3; i += 3) {
      positions[i] += currentSpeed; // Gerak di sumbu Z menuju kamera
      
      // Reset partikel jika sudah lewat kamera
      if (positions[i] > 100) {
        positions[i] = -100; 
      }
    }
    particlesGeometry.attributes.position.needsUpdate = true;

    renderer.render(scene, camera);
  };

  animate();

  // Resize Handler
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
};

// Initialize 3D Scene
init3D();

/* =========================================
   LOGIKA HTML/JS UMUM (ANIMASI & UTILS)
   ========================================= */

/* --- ANIMASI SCROLL --- */
const observerOptions = { threshold: 0.1 };
const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) entry.target.classList.add('visible');
  });
}, observerOptions);
document.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));

/* --- BUKA UNDANGAN (WARP EFFECT) --- */
function openInvitation() {
  // Panggil fungsi Warp Speed dari Three.js
  if (window.triggerWarp) window.triggerWarp();

  const overlay = document.getElementById('cover-overlay');
  overlay.classList.add('opened');
  
  // Musik (Optional)
  // document.getElementById('bg-music').play(); 
  
  // Scroll unlock
  document.body.style.overflowY = "auto";
}

/* --- COUNTDOWN --- */
setInterval(() => {
  const now = new Date().getTime();
  const distance = TARGET_DATE - now;
  if (distance > 0) {
    document.getElementById("cd-days").innerText = Math.floor(distance / (1000 * 60 * 60 * 24));
    document.getElementById("cd-hours").innerText = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    document.getElementById("cd-mins").innerText = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    document.getElementById("cd-secs").innerText = Math.floor((distance % (1000 * 60)) / 1000);
  } else {
    document.getElementById("countdown").innerHTML = "<h3 style='color:var(--gold)'>Acara Telah Dilaksanakan</h3>";
  }
}, 1000);

/* =========================================
   LOGIKA RSVP (FIXED VERSION)
   ========================================= */
function kirim() {
  const nama = document.getElementById('nama');
  const hadir = document.getElementById('hadir');
  const pesan = document.getElementById('pesan');
  const alamat = document.getElementById('alamat'); 
  const btn = document.getElementById('btn-submit');

  // 1. Validasi
  if(!nama.value || !pesan.value || !alamat.value) {
    showToast("Mohon lengkapi Nama, Alamat, dan Ucapan");
    return;
  }

  // 2. Token Handling
  let t = localStorage.getItem("token");
  if (!t) {
    t = "TAMU-" + Date.now().toString(36) + Math.random().toString(36).substr(2);
    localStorage.setItem("token", t);
  }

  // 3. UI Loading
  btn.disabled = true;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mengirim...';
  
  console.log("Mengirim data...");

  // 4. Siapkan Data
  const params = new URLSearchParams();
  params.append("mode", "rsvp");
  params.append("nama", nama.value);
  params.append("hadir", hadir.value);
  params.append("pesan", pesan.value);
  params.append("alamat", alamat.value || "");
  params.append("token", t);

  // 5. Fetch Data (SOLUSI ANTI CORS)
  fetch(SCRIPT_URL, {
    method: "POST",
    body: params,
    mode: 'no-cors' 
  })
  .then(() => {
    console.log("Fetch selesai");
    
    // Beri jeda sedikit
    setTimeout(() => {
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-paper-plane"></i> Kirim Konfirmasi';
      
      document.getElementById('rsvp-form-container').classList.add('hidden');
      document.getElementById('rsvp-success').classList.remove('hidden');
      
      const qrContainer = document.getElementById("qr");
      qrContainer.innerHTML = "";
      new QRCode(qrContainer, {
        text: t,
        width: 160,
        height: 160,
        colorDark: "#000",
        colorLight: "#fff",
        correctLevel: QRCode.CorrectLevel.H
      });
      
      showToast("Konfirmasi Berhasil!");
    }, 1500);
  })
  .catch((err) => {
    console.error("Network Error:", err);
    btn.disabled = false;
    btn.innerHTML = '<i class="fas fa-paper-plane"></i> Kirim Konfirmasi';
    showToast("Gagal mengirim data. Cek koneksi internet.");
  });
}

function resetForm() {
  document.getElementById('nama').value = "";
  document.getElementById('alamat').value = "";
  document.getElementById('pesan').value = "";
  document.getElementById('rsvp-success').classList.add('hidden');
  document.getElementById('rsvp-form-container').classList.remove('hidden');
}

/* --- TOAST NOTIFICATION --- */
function showToast(message) {
  const toast = document.createElement('div');
  toast.style.position = 'fixed'; toast.style.bottom = '30px'; toast.style.left = '50%';
  toast.style.transform = 'translateX(-50%)'; toast.style.background = 'var(--gold)';
  toast.style.color = '#000'; toast.style.padding = '14px 30px'; toast.style.borderRadius = '50px';
  toast.style.zIndex = '10000'; toast.style.fontWeight = '600'; toast.style.boxShadow = '0 0 20px var(--gold)';
  toast.style.opacity = '0'; toast.style.transition = 'opacity 0.4s'; 
  toast.innerText = message;
  document.body.appendChild(toast);
  setTimeout(() => toast.style.opacity = '1', 10);
  setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
}

/* --- MUSIC TOGGLE --- */
let isPlaying = false;
function toggleMusic() {
  const btn = document.getElementById('music-btn');
  isPlaying = !isPlaying;
  if(isPlaying) {
    btn.innerHTML = '<i class="fas fa-pause"></i>';
    btn.style.animation = 'none';
    // play audio logic here
  } else {
    btn.innerHTML = '<i class="fas fa-music"></i>';
    btn.style.animation = 'float 3s ease-in-out infinite';
    // pause audio logic here
  }
}
</script>
</body>
</html>
