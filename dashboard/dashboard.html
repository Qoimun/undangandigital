<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Panitia â€” Wedding</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#0f0c0a;
  color:#d4af6a;
  font-family:Arial, sans-serif;
  padding:20px;
}
h1 { text-align:center; }

input, button, select {
  padding:10px;
  border-radius:6px;
  border:none;
  margin:5px;
}

button {
  background:#d4af6a;
  color:#000;
  cursor:pointer;
  font-weight:bold;
}

.stats {
  display:flex;
  justify-content:space-around;
  margin:20px 0;
}
.card {
  background:#1a1613;
  padding:15px;
  border-radius:10px;
  width:30%;
  text-align:center;
}

/* =================== TABEL =================== */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  table-layout: auto; /* otomatis menyesuaikan konten */
}

th, td {
  border: 1px solid #333;
  padding: 10px 8px;
  font-size: 0.9rem;
  text-align: left;
  vertical-align: top; /* agar header dan data sejajar */
  word-break: break-word; /* wrap teks panjang */
}

/* Lebar kolom */
th:nth-child(1), td:nth-child(1) { width: 25%; }
th:nth-child(2), td:nth-child(2) { width: 20%; }
th:nth-child(3), td:nth-child(3) { width: 20%; }
th:nth-child(4), td:nth-child(4) { width: 35%; }

th {
  background-color: #1a1613;
  color: #fff;
}

td {
  background-color: #0f0c0a;
}

tr:nth-child(even) td {
  background-color: #1c1814; /* zebra stripe */
}

.success { color:#00ff9c; font-weight:bold; } /* Hadir */
.warn { color:#ffcc00; font-weight:bold; }   /* Belum Hadir */
.danger { color:#ff4c4c; font-weight:bold; } /* Tidak Hadir */

.hidden { display:none; }

@media(max-width:600px){
  .stats { flex-direction:column; }
  .card { width:100%; margin-bottom:10px; }
  th, td { font-size:0.8rem; padding:6px 4px; }
}
</style>
</head>

<body>

<h1>ðŸ“Š Dashboard Panitia</h1>

<!-- LOGIN -->
<div id="login">
  <p>Masukkan PIN Panitia</p>
  <input type="password" id="pin" placeholder="PIN">
  <button onclick="login()">Masuk</button>
  <p id="loginMsg"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

  <div class="stats">
    <div class="card">
      <h2 id="total">0</h2>
      <p>Total RSVP</p>
    </div>
    <div class="card">
      <h2 id="hadir">0</h2>
      <p>Hadir</p>
    </div>
    <div class="card">
      <h2 id="belum">0</h2>
      <p>Belum Hadir</p>
    </div>
  </div>

  <input type="text" id="search" placeholder="Cari nama..." onkeyup="render()">
  <select id="filter" onchange="render()">
    <option value="all">Semua</option>
    <option value="HADIR">Hadir</option>
    <option value="BELUM">Belum Hadir</option>
    <option value="TIDAK">Tidak Hadir</option>
  </select>

  <button onclick="exportExcel()">â¬‡ Export Excel</button>

  <table>
    <thead>
      <tr>
        <th>Nama</th>
        <th>Kehadiran</th>
        <th>Status</th>
        <th>Waktu</th>
      </tr>
    </thead>
    <tbody id="data"></tbody>
  </table>

</div>

<script>
/* ============================= KONFIGURASI ============================= */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw8hlNUj25__RM2eKvzSA6lgfbXRsiOmR6aUdvCaRTDF9MH6XGek02EAMyqvMYOOt-6eQ/exec";
const PIN_BENAR = "230526"; // GANTI PIN DI SINI

let rows = [];

/* ============================= LOGIN ============================= */
function login(){
  const pin = document.getElementById("pin").value;
  if(pin === PIN_BENAR){
    document.getElementById("login").style.display="none";
    document.getElementById("dashboard").classList.remove("hidden");
    loadData();
    setInterval(loadData, 5000); // realtime refresh
  } else {
    document.getElementById("loginMsg").innerText="âŒ PIN salah";
  }
}

/* ============================= LOAD DATA ============================= */
function loadData(){
  fetch(SCRIPT_URL + "?mode=dashboard")
    .then(res=>res.json())
    .then(data=>{
      // Normalisasi status
      rows = data.map(r=>{
        let status = r.status ? r.status.toUpperCase() : "BELUM";
        if(status !== "HADIR" && status !== "BELUM") status = "TIDAK";
        return {...r, status};
      });
      updateStats();
      render();
    });
}

/* ============================= STATS ============================= */
function updateStats(){
  const total = rows.length;
  const hadir = rows.filter(r=>r.status==="HADIR").length;
  const belum = rows.filter(r=>r.status==="BELUM").length;
  document.getElementById("total").innerText = total;
  document.getElementById("hadir").innerText = hadir;
  document.getElementById("belum").innerText = belum;
}

/* ============================= RENDER TABLE ============================= */
function render(){
  const tbody = document.getElementById("data");
  const q = document.getElementById("search").value.toLowerCase();
  const f = document.getElementById("filter").value;

  tbody.innerHTML = rows.filter(r=>{
    const matchFilter = (f==="all" || r.status===f);
    const matchSearch = r.nama.toLowerCase().includes(q);
    return matchFilter && matchSearch;
  }).map(r=>{
    let cls = r.status==='HADIR' ? 'success' : (r.status==='BELUM' ? 'warn' : 'danger');
    return `<tr>
      <td>${r.nama}</td>
      <td>${r.kehadiran}</td>
      <td class="${cls}">${r.status}</td>
      <td>${r.waktu||''}</td>
    </tr>`;
  }).join('');
}

/* ============================= EXPORT ============================= */
function exportExcel(){
  window.open(SCRIPT_URL + "?mode=export");
}
</script>

</body>
</html>
